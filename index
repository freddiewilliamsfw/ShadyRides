import csv
import datetime
import math
import os
from typing import Tuple, List

# ... [Previous class definitions for BusStop and BusRoute remain the same] ...

def load_bus_routes(csv_file: str) -> dict:
    routes = {}
    try:
        with open(csv_file, 'r') as file:
            csv_reader = csv.DictReader(file)
            for row in csv_reader:
                route_number = row['Route']
                if route_number not in routes:
                    routes[route_number] = BusRoute(route_number)
                
                stop = BusStop(
                    row['Bus_Stop_Code'],
                    row['Stop_Name'],
                    int(row['Location_Easting']),
                    int(row['Location_Northing'])
                )
                routes[route_number].add_stop(stop)
        return routes
    except FileNotFoundError:
        print(f"Error: The file '{csv_file}' was not found.")
        print(f"Current working directory: {os.getcwd()}")
        print("Please ensure the CSV file is in the correct location and named correctly.")
        return None
    except Exception as e:
        print(f"An error occurred while reading the file: {e}")
        return None

# ... [Other functions remain the same] ...

def main():
    print("London Bus Shade App")
    
    csv_file = 'bus_routes.csv'
    routes = load_bus_routes(csv_file)
    
    if not routes:
        print("Unable to proceed due to data loading error.")
        return
    
    route_number = input("Enter bus route number: ")
    if route_number not in routes:
        print("Route not found.")
        return
    
    route = routes[route_number]
    
    print("Available stops:")
    for i, stop in enumerate(route.stops):
        print(f"{i+1}. {stop.name}")
    
    try:
        start_index = int(input("Enter starting stop number: ")) - 1
        end_index = int(input("Enter ending stop number: ")) - 1
        
        start_stop = route.stops[start_index]
        end_stop = route.stops[end_index]
    except (ValueError, IndexError):
        print("Invalid stop number entered. Please try again.")
        return
    
    current_time = datetime.datetime.now()
    sun_position = calculate_sun_position(current_time, start_stop.easting, start_stop.northing)
    
    bus_direction = determine_bus_direction(
        (start_stop.easting, start_stop.northing),
        (end_stop.easting, end_stop.northing)
    )
    
    shade_side = calculate_shade_side(bus_direction, sun_position[0])
    
    print(f"For the most shade, sit on the {shade_side} side of the bus.")

if __name__ == "__main__":
    main()
